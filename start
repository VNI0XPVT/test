#!/bin/bash

# Set colors
GREEN="\e[32m"
RED="\e[31m"
YELLOW="\e[33m"
RESET="\e[0m"

log() {
    echo -e "${YELLOW}[$(date '+%H:%M:%S')]${RESET} $1"
}

error_exit() {
    echo -e "${RED}[ERROR] $1${RESET}"
    exit 1
}

# Check for already running bot
if pgrep -f "python3 -m AnonMusic" > /dev/null; then
    error_exit "AnonMusic is already running!"
fi

# Clean up
log "Cleaning old logs, sessions, and cache..."
rm -f logs.txt log.txt *.session &>/dev/null
rm -rf __pycache__ &>/dev/null

# Disable IPv6 safely
log "Disabling IPv6..."
sysctl -q -w net.ipv6.conf.all.disable_ipv6=1
sysctl -q -w net.ipv6.conf.default.disable_ipv6=1
sysctl -q -w net.ipv6.conf.lo.disable_ipv6=1

# Delay before starting
sleep 1

# Start the bot
log "Starting AnonMusic Bot..."
python3 -m AnonMusic || error_exit "Bot exited unexpectedly."
